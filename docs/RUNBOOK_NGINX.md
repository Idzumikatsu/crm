# NGINX Incident Runbook

## Проверка контейнеров
1. Выполните `docker compose ps` и убедитесь, что сервисы `app` и `nginx` имеют
   статус `healthy`.
2. Если контейнер `app` перезапускается либо имеет статус `Exited`, изучите его
   лог:
   ```bash
   docker compose logs app
   ```
   Просмотреть логи всех сервисов можно командой `make logs`.
3. При необходимости перезапустите инфраструктуру:
   ```bash
   make up
   ```

## Высокая задержка или ошибки
1. Проверить здоровье backend-контейнеров.
2. Изучить error.log на предмет обрывов соединений.
3. Проверить недавние деплои конфигурации.

## Проблемы с сертификатами
1. Убедиться в корректности файлов сертификата и ключа.
2. После обновления выполнить `nginx -s reload`.

## Неожиданный перезапуск
1. Проверить логи автоматизации CI/CD.
2. Удостовериться в успешной валидации конфигурации.

## Проверка эндпоинтов
1. Запросите `/actuator/health` приложения, чтобы убедиться в его работоспособности:
   ```bash
   curl -f http://localhost:8080/actuator/health
   ```
2. Убедитесь, что метрики доступны по `/actuator/prometheus`:
   ```bash
   curl http://localhost:8080/actuator/prometheus
   ```
3. Метрики Nginx предоставляет контейнер `nginx-exporter` на порту `9114`:
   ```bash
   curl http://localhost:9114/metrics
   ```
